#!/usr/bin/env bash
set -euo pipefail

if [ $# -lt 1 ]; then
  echo "Usage: $0 <repo_id> [revision]" >&2
  echo "Example: $0 meta-llama/Llama-3.1-8B-Instruct" >&2
  exit 1
fi

REPO_ID="$1"
REVISION="${2-}"

# Base API URL: GET /api/models/{repo_id} (Hugging Face Hub API):contentReference[oaicite:0]{index=0}
URL="https://huggingface.co/api/models/${REPO_ID}"
if [ -n "$REVISION" ]; then
  URL="${URL}/revision/${REVISION}"
fi

# Optional: use HF_TOKEN env var for private/gated models
CURL_ARGS=(-s)
if [ -n "${HF_TOKEN-}" ]; then
  CURL_ARGS+=(-H "Authorization: Bearer ${HF_TOKEN}")
fi

JSON=$(curl "${CURL_ARGS[@]}" "$URL")

# Sum the 'size' field of all files ("siblings") in the repo.
# This is metadata only; nothing is actually downloaded from LFS.:contentReference[oaicite:1]{index=1}
TOTAL_BYTES=$(printf '%s\n' "$JSON" | jq '[.siblings[]? | (.size // 0)] | add')

# Basic error check
if [ -z "$TOTAL_BYTES" ] || [ "$TOTAL_BYTES" = "null" ]; then
  echo "Failed to read file sizes from API response." >&2
  exit 1
fi

# Human-readable conversions
TOTAL_KB=$(awk "BEGIN {printf \"%.2f\", $TOTAL_BYTES/1024}")
TOTAL_MB=$(awk "BEGIN {printf \"%.2f\", $TOTAL_BYTES/1024/1024}")
TOTAL_GB=$(awk "BEGIN {printf \"%.2f\", $TOTAL_BYTES/1024/1024/1024}")

echo "Repo:      ${REPO_ID}"
[ -n "$REVISION" ] && echo "Revision:  ${REVISION}"
echo "Total:     ${TOTAL_BYTES} bytes"
echo "           ${TOTAL_KB} KB"
echo "           ${TOTAL_MB} MB"
echo "           ${TOTAL_GB} GB"


