# === TMUX CONFIG STRUCTURE GUIDE ===
# 1. Core settings: prefix, keybinds, navigation, basic tmux behavior.
# 2. Interface/styling: colors, status bar, mouse, escape-time, borders.
# 3. Plugin declarations: list all plugins with set -g @plugin '...'
# 4. Plugin options: configure each plugin (e.g. @continuum-restore, @resurrect-strategy).
# 5. TPM bootstrap: run '~/.tmux/plugins/tpm/tpm' must be the final line.

# Change prefix from Ctrl-b to Ctrl-a
set -g prefix C-a

# Unbind the old prefix
unbind C-b

# Ensure Ctrl-a can be sent to applications when pressed twice
bind C-a send-prefix

# Splits without prefix
# Note: terminals vary in how they send these Ctrl+Shift keys.
# Many terminals treat Ctrl+" as Ctrl+' (unshifted key), so bind both.
bind -n C-\" split-window -v -c "#{pane_current_path}"  # Ctrl+" = horizontal split
bind -n "C-'" split-window -v -c "#{pane_current_path}" # fallback for Ctrl+"
bind -n C-| split-window -h -c "#{pane_current_path}"    # Ctrl+| = vertical split

# Vim-style pane navigation
bind h select-pane -L
bind j select-pane -D
bind k select-pane -U
bind l select-pane -R

# Vim-style pane resizing
bind -r H resize-pane -L 1
bind -r J resize-pane -D 1
bind -r K resize-pane -U 1
bind -r L resize-pane -R 1


bind-key S swap-window -t !

# ── Choose-tree (prefix+s/w) ────────────────────────────────
# Session name padded to 20 chars for alignment, git info starts at consistent column
bind s choose-tree -s -F '#{?session_format,#[fg=#b8b8c8 bold]#{=|-40:session_name} #[fg=#68687a nobold]#($HOME/.tmux/scripts/session-git "#{session_name}"),#{?window_format,#[fg=#9090a0]#I#[fg=#555562]:#[fg=#b8b8c8]#W#[fg=#555562]#{window_flags},#[fg=#555562]#I:#[fg=#9090a0]#{pane_title}}}'
bind w choose-tree -w -F '#{?session_format,#[fg=#b8b8c8 bold]#{=|-40:session_name} #[fg=#68687a nobold]#($HOME/.tmux/scripts/session-git "#{session_name}"),#{?window_format,#[fg=#9090a0]#I#[fg=#555562]:#[fg=#b8b8c8]#W#[fg=#555562]#{window_flags},#[fg=#555562]#I:#[fg=#9090a0]#{pane_title}}}'



# Enable vi mode for copy mode
setw -g mode-keys vi

# enable mouse mode
set -g mouse on

# Cross-platform clipboard integration
# macOS: pbcopy/pbpaste
# Linux: xclip (X11) or wl-copy/wl-paste (Wayland) or xsel fallback
if-shell '[[ "$(uname)" == "Darwin" ]]' {
  bind -T copy-mode-vi y send -X copy-pipe-and-cancel "pbcopy"
  bind -T copy-mode-vi Enter send -X copy-pipe-and-cancel "pbcopy"
} {
  # Try Wayland first, then X11
  if-shell 'command -v wl-copy &>/dev/null' {
    bind -T copy-mode-vi y send -X copy-pipe-and-cancel "wl-copy"
    bind -T copy-mode-vi Enter send -X copy-pipe-and-cancel "wl-copy"
  } {
    if-shell 'command -v xclip &>/dev/null' {
      bind -T copy-mode-vi y send -X copy-pipe-and-cancel "xclip -selection clipboard -in"
      bind -T copy-mode-vi Enter send -X copy-pipe-and-cancel "xclip -selection clipboard -in"
    } {
      if-shell 'command -v xsel &>/dev/null' {
        bind -T copy-mode-vi y send -X copy-pipe-and-cancel "xsel --clipboard --input"
        bind -T copy-mode-vi Enter send -X copy-pipe-and-cancel "xsel --clipboard --input"
      }
    }
  }
}




# === TWENTY THEME ===

set -g default-terminal "tmux-256color"
set -ga terminal-overrides ",*256col*:Tc,ghostty:Tc"
set -g base-index 1
setw -g pane-base-index 1
set -g renumber-windows on
set -g set-titles on
set -sg escape-time 0

# ── Status bar ──────────────────────────────────────────────
set -g status-interval 1
set -g status-position bottom
set -g status-justify left
set -g status-style 'bg=#1e1e22,fg=#68687a'

set -g status-left-length 50
set -g status-left '#[fg=#b8b8c8,bold]#S #[fg=#3e3e48,nobold]│ '

set -g status-right-length 80
set -g status-right '#[fg=#555562]%H:%M #[fg=#68687a]%d %b '

setw -g window-status-format '#[fg=#555562]#I:#W '
setw -g window-status-current-format '#[fg=#b8b8c8,bold]#I:#W '
setw -g window-status-separator ''

# ── Pane borders ────────────────────────────────────────────
set -g pane-border-style 'fg=#2e2e36'
set -g pane-active-border-style 'fg=#555562'

# ── Messages & command line ─────────────────────────────────
set -g message-style 'fg=#b8b8c8,bg=#181820'
set -g message-command-style 'fg=#b8b8c8,bg=#181820'

# ── Copy/selection mode ─────────────────────────────────────
setw -g mode-style 'bg=#3e3e48,fg=#b8b8c8'

# ── Clock ───────────────────────────────────────────────────
setw -g clock-mode-colour '#d4b88c'
setw -g clock-mode-style 24



# === TPM PLUGIN MANAGER ===

# List of plugins
set -g @plugin 'tmux-plugins/tpm'
set -g @plugin 'tmux-plugins/tmux-sensible' # Recommended for sensible defaults
set -g @plugin 'tmux-plugins/tmux-resurrect' # The plugin to save/restore sessions
set -g @plugin 'tmux-plugins/tmux-continuum' # automatically saving setup (with ressurect)
set -g @plugin 'fcsonline/tmux-thumbs' # Quick hint-based text selection

set -g @continuum-restore 'on'

# Allow passthrough for image protocols (Kitty/Ghostty)
set -g allow-passthrough on

# Initialize TMUX plugin manager (keep this line at the very bottom of tmux.conf)
run '~/.tmux/plugins/tpm/tpm'
